var s=function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,i=arguments[t];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function t(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var s,o;(o=s=s||{}).CREATE="create",o.SEND="send",o.SET="set",o.REMOVE="remove";function j(){}var r,a=s,c=function(){function e(e,t){this._id=e,this._name=t,this._screenResolution="",this._screenColorDepth="",this._screenWidth=0,this._screenHeight=0,this._referer="",this._pageUrl="",this._isTest=!1}var t=e.prototype;return t.toJSON=function(){return{screenResolution:this._screenResolution,screenColorDepth:this._screenColorDepth,screenWidth:this._screenWidth,screenHeight:this._screenHeight,referer:this._referer,pageUrl:this._pageUrl,trackerId:this._id}},t.getId=function(){return this._id},t.getTrackerName=function(){return this._name},t.isTest=function(){return this._isTest},t.setScreenResolution=function(e){this._screenResolution=e},t.setScreenColorDepth=function(e){this._screenColorDepth=e},t.setScreenWidth=function(e){this._screenWidth=e},t.setScreenHeight=function(e){this._screenHeight=e},t.setTest=function(e){this._isTest=e},t.setPageUrl=function(e){this._pageUrl=e},t.setReferer=function(e){this._referer=e},e}(),u=function(i){function n(e){var t;return(t=i.call(this)||this)._options=e,t}t(n,i);var e=n.prototype;return e.getScreenResolution=function(){return window.screen.width+"x"+window.screen.height},e.getViewportSize=function(){var e=document.documentElement,t=document.body,n=t&&t.clientWidth&&t.clientHeight,i=[];return e&&e.clientWidth&&e.clientHeight&&("CSS1Compat"===document.compatMode||!n)?i=[e.clientWidth,e.clientHeight]:n&&(i=[t.clientWidth,t.clientHeight]),i},e.getScreenColorDepth=function(){return window.screen.colorDepth+"-bit"},e.getIngestionType=function(){return this._options.ingestionType},e.execute=function(e){var t=new c(this._options.id,this._options.name);t.setScreenResolution(this.getScreenResolution());var n=this.getViewportSize();t.setScreenWidth(n[0]),t.setScreenHeight(n[1]),t.setScreenColorDepth(this.getScreenColorDepth()),this._options.doneCallback&&this._options.doneCallback(t),this._options.test&&t.setTest(!0),e(t)},n}(j),h=function(){function e(e){var t=this;this.dequeue=function(){return!t.isEmpty()&&t._commands.shift()},this.dequeueAndProcessNext=function(){t._state=3,t.dequeue()&&t.process()},this.clearAndResetInterval=function(){window.clearTimeout(t._setTimeoutId),t._setTimeoutId=0},this.process=function(){t.clearAndResetInterval(),0==t._commands.length?(t._state=1,t._flushCallback()):(t._state=2,t._commands[0]&&t._commands[0].execute(t.dequeueAndProcessNext))},this._commands=[],this._state=0,this._flushCallback=e,this._intervalTimeOut=3e3,this._setTimeoutId=0}var t=e.prototype;return t.isEmpty=function(){return 0===this._commands.length},t.enqueue=function(e){var t=this;this._commands.push(e),2!==this._state&&0!==this._state&&("BATCH"===e.getIngestionType()?this._setTimeoutId||(this._setTimeoutId=window.setTimeout(function(){t.process()},this._intervalTimeOut)):this.process())},e}(),d=function(){function e(e,t,n){this._eventLabel=e,this._eventType=t,this._eventValue=n,this._timestamp=Date.now()}return e.prototype.toJSON=function(){return{eventName:this._eventLabel,type:this._eventType,value:this._eventValue,timestamp:this._timestamp}},e}(),l=((r={}).pageview="PageView",r.click="Click",r.error="Error",r.custom="Custom",r),p=["click","custom","error","pageview"],f=["BATCH","IMMEDIATE"],g=function(s){function i(t){var n;return(n=s.call(this)||this)._options=t,n._validate(t)&&(n._options=e({eventName:l[t.eventType],value:document.title},t)),n}t(i,s);var n=i.prototype;return n._validate=function(e){if(p.indexOf(e.eventType)<0)throw Error("Event "+e.eventType+" is not supported");if(f.indexOf(e.ingestionType)<0)throw Error("Ingestion type "+e.ingestionType+" is not supported");switch(e.eventType){case"click":case"custom":case"error":if(!e.eventName||!e.value)throw Error("Event ("+e.eventType+"): eventName or value is missing. Skipping event logging");break;default:return!0}return!0},n.getIngestionType=function(){return this._options.ingestionType},n.execute=function(e){var t=this._options,n=new d(t.eventName,t.eventType,t.value);this._options.doneCallback&&this._options.doneCallback(n),e(n)},i}(j),_=function(){function t(e){var s=this;this._tenantId=e,this._callbackMapping={},window.JSNetworkBridge&&window.JSNetworkBridge.processRequest&&(window.PhonePe={},window.PhonePe.MessagingHandler={},window.PhonePe.MessagingHandler.callback=function(e,t,n,i){s._callbackMapping[e]&&s._callbackMapping[e](t,n,i)})}var n=t.prototype;return n.updateCallbackMapping=function(e,t){this._callbackMapping[e]=t},n.sendXHR=function(t){var n=new XMLHttpRequest;n.withCredentials=!0,n.open(t.method,t.url,!0),n.setRequestHeader("Content-Type","application/json"),t.headers&&(delete t.headers.cookie,delete t.headers.origin),t.headers&&Object.keys(t.headers).map(function(e){n.setRequestHeader(e,(null==t?void 0:t.headers)&&(null==t?void 0:t.headers[e])||"")}),n.onreadystatechange=function(){this.readyState!==XMLHttpRequest.DONE||200!==this.status&&204!==this.status||t.cb&&t.cb()},"POST"==t.method?n.send(JSON.stringify(t.requestBody)):n.send()},n.sendBridgeRequest=function(e){var t={baseUrl:e.baseUrl,subUrl:e.subUrl,httpMethod:e.method,headers:e.headers,bodyJSON:JSON.stringify(e.requestBody),"content-type":"application/json",callbackId:e.callbackId};window.JSNetworkBridge.processRequest(JSON.stringify(t))},n.send=function(e){window.JSNetworkBridge&&window.JSNetworkBridge.processRequest?(e.callbackId&&e.callbackFn&&this.updateCallbackMapping(e.callbackId,e.callbackFn),this.sendBridgeRequest(e)):this.sendXHR(e)},n.initClient=function(i){var e=1e9*Math.random(),t={url:"https://api.phonepe.com/apis/garfield/v1/init/"+this._tenantId,baseUrl:"https://api.phonepe.com/apis/garfield/v1",subUrl:"bridge/init/"+this._tenantId,method:"POST",cb:i,headers:{cookie:document.cookie,origin:window.location.origin,"X-NAMESPACE-ID":this._tenantId},callbackFn:function(e,t){var n;void 0===t&&(t=""),"1"===e&&(((n=JSON.parse(atob(t))).headers&&n.headers["set-cookie"]||[]).forEach(function(e){document.cookie=e}),i&&i())},callbackId:e};this.send(t)},n.processAndSend=function(t,n){t.setPageUrl(window.location.protocol+"//"+window.location.hostname+window.location.pathname),t.setReferer(document.referrer);var i={};t.isTest()&&(i={"X-TESTING_ENABLED":"true"});var s={url:"https://api.phonepe.com/apis/garfield/v1/ingest",baseUrl:"https://api.phonepe.com/apis/garfield/v1",subUrl:"bridge/ingest",method:"POST",requestBody:e({},t.toJSON(),{events:n,namespaceId:this._tenantId}),headers:e({cookie:document.cookie,origin:window.location.origin,"X-NAMESPACE-ID":this._tenantId},i),"content-type":"application/json"};this.send(s)},t}(),m=function(){function t(e){var i=this;this.start=function(){window.addEventListener("load",i.startProcessing)},this.addTracker=function(e){i._trackers.push(e),i._events[e.getId()]=[]},this.addEvent=function(e,t){var n=i.getDefaultTracker().getId();void 0!==t&&(n=t),i._events[n].push(e)},this.startProcessing=function(){i._commandQueue.process()},this.flushEvents=function(){for(var e in i._events)0<i._events[e].length&&(i._networkManager.processAndSend(i.getTrackerById(e),i._events[e].map(function(e){return e.toJSON()})),i._events[e]=[])},this._trackers=[],this._events={},this._commandQueue=new h(this.flushEvents),this._networkManager=new _(e),this._networkManager.initClient(this.startProcessing)}var n=t.prototype;return n.getDefaultTracker=function(){return this._trackers[0]},n.getTrackerById=function(t){return this._trackers.filter(function(e){return e.getId()===t})[0]},n.queueCommand=function(t,n){switch(t.toLowerCase()){case a.CREATE:var i=e({doneCallback:this.addTracker},n),s=new u(i);this._commandQueue.enqueue(s);break;case a.SEND:var o=t.split("."),r=this.addEvent;if(1<o.length&&(r=function(i){for(var e=arguments.length,s=new Array(1<e?e-1:0),t=1;t<e;t++)s[t-1]=arguments[t];return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.apply(void 0,t.concat(s))}}(this.addEvent,o[0])),n.eventType)try{s=new g(e({ingestionType:"BATCH"},n,{doneCallback:r})),this._commandQueue.enqueue(s)}catch(e){}}},t}(),v=new(function(){function e(e){this._commandManager=new m(e)}return e.prototype.executeCommand=function(e,t){var n={};switch(e.toLowerCase()){case a.CREATE:if("string"==typeof t)n.id=t;else if(!("id"in t))throw new Error("Missing field 'id' not sent while creating a Tracker");this._commandManager.queueCommand(a.CREATE,n=t);break;case a.SEND:"string"==typeof t?n.eventType=t:n=t,this._commandManager.queueCommand(a.SEND,n)}},e}())(window.GaNamespaceId),w=window.GarfieldObjName;window[w].q.map(function(e){v.executeCommand.apply(v,e)}),window[w]=function(e,t){v.executeCommand.call(v,e,t)}};"function"==typeof define&&define.amd?define(s):s();